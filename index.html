<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
  <title>PROMPT STREAM // DASHBOARD</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Share+Tech+Mono&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    :root {
      --bg: #050505; --panel-bg: #111518; --card-bg: #161a1e;
      --primary: #00f3ff; --secondary: #ffaa00; --accent: #ff0055;
      --text: #cceeee; --dim: #668888; --border: #334444;
      --type-speech: #00f3ff; --type-char: #ff00cc; --type-code: #00ff99; --type-free: #668888;
      --header-h: 50px; --footer-h: 60px;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Share Tech Mono', 'Zen Kaku Gothic New', monospace; background: var(--bg); color: var(--text); margin: 0; height: 100dvh; overflow: hidden; display: flex; flex-direction: column; }

    /* UI Components */
    header { height: var(--header-h); background: rgba(11,15,18,0.98); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 8px; z-index: 20; flex-shrink: 0; }
    h1 { font-size: 16px; letter-spacing: 1px; margin: 0; }
    .actions { display: flex; gap: 6px; }
    .btn { background: transparent; border: 1px solid var(--border); color: var(--text); padding: 6px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; font-family: inherit; }
    .btn.active, .btn:active { background: var(--border); color: #fff; }
    .btn.primary { border-color: var(--primary); color: var(--primary); }
    .btn.accent { border-color: var(--secondary); color: var(--secondary); }
    .btn.danger { border-color: var(--accent); color: var(--accent); }

    /* Palette */
    .palette { background: var(--panel-bg); padding: 10px; border-bottom: 1px solid var(--border); display: flex; gap: 8px; overflow-x: auto; align-items: center; z-index: 15; flex-shrink: 0; }
    .p-btn { flex: 0 0 auto; background: #000; border: 1px solid var(--border); border-left: 3px solid #555; color: var(--text); padding: 8px 10px; border-radius: 4px; cursor: pointer; min-width: 75px; display: flex; flex-direction: column; font-size: 12px; }
    .p-btn span { font-size: 9px; opacity: 0.7; margin-top: 2px; }
    .pb-speech { border-left-color: var(--type-speech); } .pb-char { border-left-color: var(--type-char); } .pb-code { border-left-color: var(--type-code); } .pb-snip { border-left-color: var(--secondary); border-style: dotted; }

    /* --- DASHBOARD (New Setting Panel) --- */
    #dashboard { background: #0a0d10; border-bottom: 1px solid var(--secondary); padding: 10px; display: none; overflow-y: auto; max-height: 40vh; flex-shrink: 0; }
    #dashboard.open { display: block; }
    .dash-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: flex-end; }
    .dash-group { flex: 1; }
    .dash-group label { display: flex; justify-content: space-between; font-size: 10px; color: var(--secondary); margin-bottom: 4px; }
    .dash-group input[type="range"] { width: 100%; height: 4px; background: #333; appearance: none; border-radius: 2px; }
    .dash-group input[type="range"]::-webkit-slider-thumb { appearance: none; width: 12px; height: 12px; background: var(--secondary); border-radius: 50%; }
    .dash-select { width: 100%; background: #000; color: #fff; border: 1px solid var(--border); padding: 4px; font-size: 11px; }
    
    .preset-list { display: flex; gap: 6px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 10px; }
    .pre-tag { flex: 0 0 auto; padding: 4px 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 10px; cursor: pointer; background: #111; }
    .pre-tag.active { border-color: var(--secondary); color: var(--secondary); background: rgba(255, 170, 0, 0.1); }
    .pre-tag .del { margin-left: 5px; color: var(--accent); font-weight: bold; }

    /* Stream */
    .stream-container { flex: 1; overflow-y: auto; padding: 15px 10px; position: relative; }
    body.mode-rapid .stream-container { padding-bottom: 80px; }

    /* Cards */
    .card { background: var(--card-bg); border: 1px solid var(--border); border-left: 3px solid var(--dim); border-radius: 4px; margin-bottom: 12px; display: flex; flex-direction: column; }
    .card-head { display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; background: rgba(0,0,0,0.3); border-bottom: 1px solid rgba(255,255,255,0.05); }
    .card-label { font-size: 10px; text-transform: uppercase; font-weight: bold; cursor: pointer; user-select: none; }
    .card-label::after { content:' ‚Üª'; opacity:0.5; }
    .card-tools { display: flex; gap: 8px; }
    .tool-btn { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border: 1px solid #333; background: #000; color: #777; border-radius: 4px; cursor: pointer; font-size: 12px; }
    .drag-handle { cursor: grab; color: var(--border); font-size: 18px; touch-action: none; } .drag-handle::after { content: '‚â°'; }
    .card textarea { width: 100%; padding: 12px; background: transparent; border: none; color: var(--text); resize: none; font-family: 'Zen Kaku Gothic New', monospace; font-size: 15px; outline: none; min-height: 50px; display: block; }
    .type-speech { border-left-color: var(--type-speech); } .type-speech .card-label { color: var(--type-speech); }
    .type-char { border-left-color: var(--type-char); background: #1a0f15; } .type-char .card-label { color: var(--type-char); }
    .type-code { border-left-color: var(--type-code); background: #080a0c; } .type-code .card-label { color: var(--type-code); } .type-code textarea { font-family: 'Fira Code', monospace; color: var(--type-code); font-size: 13px; }
    .card-settings { padding: 10px; background: rgba(255, 170, 0, 0.1); border-top: 1px solid var(--border); display: none; }
    .card-settings.active { display: block; }

    /* Footer & Modals */
    .rapid-footer { height: var(--footer-h); border-top: 1px solid var(--border); background: var(--panel-bg); padding: 0 10px; display: flex; align-items: center; gap: 10px; position: absolute; bottom: 0; width: 100%; transform: translateY(100%); transition: transform 0.3s; }
    body.mode-rapid .rapid-footer { transform: translateY(0); }
    .rapid-input { flex: 1; background: #000; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 20px; outline: none; }
    .rapid-send { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); border: none; font-weight: bold; cursor: pointer; }
    
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(4px); z-index: 100; display: none; align-items: center; justify-content: center; }
    .modal-box { background: var(--panel-bg); border: 1px solid var(--border); width: 90%; max-width: 450px; max-height: 85vh; border-radius: 8px; display: flex; flex-direction: column; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
    .modal-head { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-weight: bold; }
    .modal-body { padding: 15px; overflow-y: auto; }
    .list-item { background: var(--card-bg); border: 1px solid var(--border); padding: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-radius: 4px; }
    .tag { font-size: 10px; background: #333; padding: 2px 5px; border-radius: 3px; color: #aaa; margin-right: 5px; display:inline-block; margin-bottom:4px; cursor:pointer;}
  </style>
</head>
<body class="mode-rapid">

  <header>
    <h1>PROMPT<span>v15</span></h1>
    <div class="actions">
      <button class="btn" onclick="app.toggleMode()">‚ö° MODE</button>
      <a href="./persona.html"><button class="btn">PERSONA‚Üí</button></a>
      <button class="btn danger" onclick="app.clearBoard()">CLR</button>
      <button class="btn" style="color:var(--type-char); border-color:var(--type-char)" onclick="modals.open('char')">CHARS</button>
      <button class="btn accent" onclick="app.toggleDashboard()">DATA</button>
      <button class="btn primary" onclick="modals.open('share')">SHARE</button>
    </div>
  </header>

  <div class="palette">
    <div class="p-btn" onmousedown="editor.insert('****')">****<span>WILD</span></div>
    <div class="p-btn" onmousedown="editor.insert('[', ']')">[ ]<span>BRA</span></div>
    <div class="p-btn" onmousedown="editor.insert('\n---\n')">---<span>SEP</span></div>
    <div class="p-btn pb-snip" onmousedown="modals.open('parts')">WORDS<span>PARTS</span></div>
    <div class="p-btn pb-speech" onclick="board.add('speech')">Dialogue<span>‰ºöË©±</span></div>
    <div class="p-btn pb-char" onclick="board.add('char')">Character<span>‰∫∫Ê†º</span></div>
    <div class="p-btn pb-code" onclick="board.add('code')">Code<span>„É≠„Ç∏„ÉÉ„ÇØ</span></div>
    <div class="p-btn" onclick="board.add('free')">Text<span>Âú∞Êñá</span></div>
    <div class="p-btn pb-snip" onclick="modals.open('snippet')">Snippet<span>VBA</span></div>
  </div>

  <div id="dashboard">
    <div class="dash-row">
      <div class="dash-group">
        <label>MUTABLE <span id="disp-mutable">100%</span></label>
        <input type="range" id="global-mutable" min="0" max="200" step="10" oninput="settings.updateUI()">
      </div>
      <div class="dash-group">
        <label>GENERATE <span id="disp-generate">100%</span></label>
        <input type="range" id="global-generate" min="50" max="200" step="10" oninput="settings.updateUI()">
      </div>
      <div class="dash-group" style="flex:0.6">
        <label>REFINE</label>
        <select id="global-refine" class="dash-select" onchange="settings.saveState()">
          <option value="low">low</option><option value="middle" selected>mid</option><option value="high">high</option>
        </select>
      </div>
    </div>
    
    <div class="preset-list" id="preset-list-container"></div>
    
    <div class="dash-row">
        <input id="newPresetName" class="dash-select" placeholder="New Preset Name" style="flex:1;">
        <button class="btn accent" onclick="settings.saveCustom()">SAVE PRESET</button>
        <button class="btn" onclick="modals.open('projects')">LOAD PROJECT...</button>
    </div>
  </div>

  <div class="stream-container">
    <div id="streamList"></div>
  </div>

  <div class="rapid-footer">
    <input type="text" id="rapidInput" class="rapid-input" placeholder="Rapid Fire..." onkeypress="if(event.key==='Enter') app.sendRapid()">
    <button class="rapid-send" onclick="app.sendRapid()">‚Üë</button>
  </div>

  <textarea id="basePrompt" style="display:none;">
[ParamControl]
GlobalAdjustMutable: 100%
GlobalGenerateAmount: 100%
Refinement: middle
WildcardRule: "****„ÅØÊñáËÑà„Å´Âøú„ÅòË£úÂÆå"
OutputRange: "@startpoint„Åã„Çâ@endpoint„ÅÆ„Åø"
MutableApplication: "[AdjustMutable]ÂÑ™ÂÖà„ÄÇ„Å™„Åë„Çå„Å∞GlobalÂÄ§"
[/ParamControl]
  </textarea>

  <div id="modal-projects" class="modal"><div class="modal-box" style="border-color:var(--secondary)"><div class="modal-head" style="color:var(--secondary)">PROJECTS <span onclick="modals.close('projects')">√ó</span></div><div class="modal-body"><input id="projName" placeholder="Project Name" style="width:100%;padding:8px;margin-bottom:8px;background:#000;border:1px solid #444;color:#fff;"><button class="btn accent" style="width:100%;" onclick="projects.save()">SAVE BOARD</button><div id="projectList" style="margin-top:10px;"></div></div></div></div>
  <div id="modal-share" class="modal"><div class="modal-box"><div class="modal-head" style="color:var(--primary)">SHARE <span onclick="modals.close('share')">√ó</span></div><div class="modal-body" style="display:flex; flex-direction:column; gap:10px;"><button class="btn" style="padding:15px;" onclick="sharing.copyText()">üöÄ COPY TEXT</button><button class="btn" style="padding:15px;" onclick="sharing.copyCode()">ü§ñ COPY FOR AI</button><button class="btn" style="padding:15px;" onclick="sharing.download()">üíæ DOWNLOAD .TXT</button></div></div></div>
  <div id="modal-char" class="modal"><div class="modal-box"><div class="modal-head" style="color:var(--type-char)">CHARACTERS <span onclick="modals.close('char')">√ó</span></div><div class="modal-body" id="list-char"></div></div></div>
  <div id="modal-snippet" class="modal"><div class="modal-box"><div class="modal-head" style="color:var(--type-code)">SNIPPETS <span onclick="modals.close('snippet')">√ó</span></div><div class="modal-body"><div id="list-snippet"></div><input id="snipName" placeholder="Name" style="width:100%;margin-top:10px;"><textarea id="snipContent" placeholder="Code..." style="width:100%;"></textarea><button class="btn" onclick="snippets.add()">ADD</button></div></div></div>
  <div id="modal-parts" class="modal"><div class="modal-box"><div class="modal-head" style="color:var(--secondary)">INLINE PARTS <span onclick="modals.close('parts')">√ó</span></div><div class="modal-body"><div id="list-parts"></div><input id="partInput" placeholder="New Word" style="width:70%;"><button onclick="parts.add()">ADD</button></div></div></div>

  <script>
    const CONFIG = {
      types: { speech: { l:'Dialogue', p:'„Äå‚Ä¶‚Ä¶„Äç', r:2, c:'type-speech'}, char: { l:'Character', p:'[AI personality...]', r:6, c:'type-char'}, code: { l:'Logic', p:'if(flag){...}', r:3, c:'type-code'}, free: { l:'Narration', p:'...', r:3, c:'type-free'} },
      defaults: { gemini: {m:100, g:100, r:'middle'}, claude: {m:80, g:110, r:'high'}, grok: {m:50, g:90, r:'middle'} }
    };
    let state = { m:100, g:100, r:'middle' };
    let lastFocused = null;

    const board = {
      init: () => {
        new Sortable(document.getElementById('streamList'), { handle:'.drag-handle', animation:150, onEnd:storage.save });
        storage.load(); settings.init();
        if(window.visualViewport) window.visualViewport.addEventListener('resize',()=>document.body.style.height=window.visualViewport.height+'px');
      },
      add: (type, val='', ctrls={m:null, g:null}) => {
        const conf = CONFIG.types[type] || CONFIG.types.free;
        const div = document.createElement('div');
        div.className = `card ${conf.c}`; div.dataset.type = type; div.dataset.ctrls = JSON.stringify(ctrls);
        div.innerHTML = `<div class="card-head"><div class="card-label" onclick="board.cycle(this)">${conf.l}</div><div class="card-tools"><div class="tool-btn" onclick="navigator.clipboard.writeText(this.closest('.card').querySelector('textarea').value)">‚ùê</div><div class="tool-btn" onclick="board.clone(this)">Ôºã</div><div class="tool-btn" style="color:var(--secondary);border-color:var(--secondary)" onclick="board.togSet(this)">‚öôÔ∏è</div><div class="tool-btn" onclick="board.del(this)">√ó</div><div class="drag-handle"></div></div></div><textarea rows="${conf.r}" placeholder="${conf.p}" oninput="board.sz(this)">${val}</textarea><div class="card-settings"><div class="range-group"><label>Mutable <span class="v-m">${ctrls.m||'Def'}</span></label><input type="range" min="0" max="200" step="10" value="${ctrls.m||state.m}" oninput="board.upd(this,'m')"></div><div class="range-group"><label>Generate <span class="v-g">${ctrls.g||'Def'}</span></label><input type="range" min="50" max="200" step="10" value="${ctrls.g||state.g}" oninput="board.upd(this,'g')"></div></div>`;
        document.getElementById('streamList').appendChild(div);
        const ta=div.querySelector('textarea'); ta.addEventListener('focus',(e)=>lastFocused=e.target);
        board.sz(ta); div.scrollIntoView({behavior:'smooth',block:'end'}); storage.save();
        if(!document.activeElement.classList.contains('rapid-input')) ta.focus();
      },
      del:(b)=>{if(confirm('Delete?')){b.closest('.card').remove();storage.save();}},
      clone:(b)=>{const c=b.closest('.card'); board.add(c.dataset.type, c.querySelector('textarea').value);},
      sz:(t)=>{t.style.height='auto';t.style.height=t.scrollHeight+'px';storage.save();},
      togSet:(b)=>{b.closest('.card').querySelector('.card-settings').classList.toggle('active');},
      upd:(el,k)=>{const c=el.closest('.card'); const d=JSON.parse(c.dataset.ctrls); d[k]=parseInt(el.value); c.dataset.ctrls=JSON.stringify(d); c.querySelector(`.v-${k}`).innerText=el.value+'%'; storage.save();},
      cycle:(el)=>{
        const c=el.closest('.card'); const keys=Object.keys(CONFIG.types);
        const nxt=keys[(keys.indexOf(c.dataset.type)+1)%4]; const conf=CONFIG.types[nxt];
        c.className=`card ${conf.c}`; c.dataset.type=nxt; el.innerText=conf.l;
        const ta=c.querySelector('textarea'); ta.placeholder=conf.p;
        if(nxt==='code'){ta.style.fontFamily='Fira Code';ta.style.color='var(--type-code)';}else{ta.style.fontFamily='inherit';ta.style.color='var(--text)';}
        storage.save();
      }
    };

    const app = {
      toggleMode:()=>{document.body.classList.toggle('mode-rapid');document.body.classList.toggle('mode-standard');},
      toggleDashboard:()=>{document.getElementById('dashboard').classList.toggle('open');},
      clearBoard:()=>{if(confirm('Clear?')){document.getElementById('streamList').innerHTML='';storage.save();}},
      sendRapid:()=>{const el=document.getElementById('rapidInput'),v=el.value.trim();if(v){let t='free';if(v.match(/^[„Äå„Äé]/))t='speech';if(v.startsWith('['))t='code';board.add(t,v);el.value='';}}
    };

    const settings = {
      init:()=>{
        state = JSON.parse(localStorage.getItem('ps_state')||JSON.stringify(CONFIG.defaults.gemini));
        settings.renderPresets(); settings.updateUI();
      },
      updateUI:()=>{
        if(event && event.target.id) {
           state.m = document.getElementById('global-mutable').value;
           state.g = document.getElementById('global-generate').value;
           state.r = document.getElementById('global-refine').value;
        } else {
           document.getElementById('global-mutable').value = state.m;
           document.getElementById('global-generate').value = state.g;
           document.getElementById('global-refine').value = state.r;
        }
        document.getElementById('disp-mutable').innerText = state.m + '%';
        document.getElementById('disp-generate').innerText = state.g + '%';
        settings.saveState();
      },
      saveState:()=>{ localStorage.setItem('ps_state', JSON.stringify(state)); },
      saveCustom:()=>{
        const name=document.getElementById('newPresetName').value; if(!name)return;
        const customs=JSON.parse(localStorage.getItem('ps_presets')||'{}');
        customs[name]={m:state.m, g:state.g, r:state.r};
        localStorage.setItem('ps_presets',JSON.stringify(customs));
        document.getElementById('newPresetName').value=''; settings.renderPresets();
      },
      delCustom:(name,e)=>{e.stopPropagation(); const c=JSON.parse(localStorage.getItem('ps_presets')); delete c[name]; localStorage.setItem('ps_presets',JSON.stringify(c)); settings.renderPresets();},
      loadPreset:(conf)=>{state={...conf}; settings.updateUI();},
      renderPresets:()=>{
        const box=document.getElementById('preset-list-container'); box.innerHTML='';
        const render=(n,d,del=false)=>{
           const div=document.createElement('div'); div.className='pre-tag'; div.innerHTML=`${n.toUpperCase()}${del?`<span class="del" onclick="settings.delCustom('${n}',event)">√ó</span>`:''}`;
           div.onclick=()=>settings.loadPreset(d); box.appendChild(div);
        };
        Object.keys(CONFIG.defaults).forEach(k=>render(k,CONFIG.defaults[k]));
        const customs=JSON.parse(localStorage.getItem('ps_presets')||'{}');
        Object.keys(customs).forEach(k=>render(k,customs[k],true));
      }
    };

    const editor = { insert:(t,e)=>{if(!lastFocused)return alert('Tap text'); const f=lastFocused,s=f.selectionStart,en=f.selectionEnd,v=f.value; f.value=v.substring(0,s)+(e?t+v.substring(s,en)+e:t)+v.substring(en); f.dispatchEvent(new Event('input')); f.focus();} };
    const sharing = {
      txt:()=>{let t=document.getElementById('basePrompt').value+'\n'; t+=`Refinement:${state.r}\nGlobalAdjustMutable:${state.m}%\nGlobalGenerateAmount:${state.g}%\n`; document.querySelectorAll('#streamList .card').forEach(c=>{const d=JSON.parse(c.dataset.ctrls); if(d.m||d.g)t+=`[Adjust:${d.m||state.m}%,Gen:${d.g||state.g}%]\n`; t+=c.querySelector('textarea').value+'\n';}); return t;},
      copyText:()=>{navigator.clipboard.writeText(sharing.txt());alert('Copied');modals.close('share');},
      copyCode:()=>{navigator.clipboard.writeText("```markdown\n"+sharing.txt()+"\n```");alert('Copied Code');modals.close('share');},
      download:()=>{const b=new Blob([sharing.txt()],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='P.txt';a.click();}
    };

    // Sub-Managers
    const modals={open:(id)=>{document.getElementById(`modal-${id}`).style.display='flex';if(id==='projects')projects.render();if(id==='char'||id==='snippet'||id==='parts')subMgr.render(id);}, close:(id)=>document.getElementById(`modal-${id}`).style.display='none'};
    const subMgr={
      db:(k)=>JSON.parse(localStorage.getItem(k)||'{}'),
      save:(k,d)=>localStorage.setItem(k,JSON.stringify(d)),
      render:(t)=>{
        const l=document.getElementById(`list-${t}`), k=t==='parts'?'ps_parts':(t==='char'?'promptChars':'promptSnippets');
        l.innerHTML=''; const d=subMgr.db(k);
        if(t==='parts'){
           (Array.isArray(d)?d:[]).forEach((v,i)=>{l.innerHTML+=`<span class="tag" onclick="if(!event.target.classList.contains('del')){editor.insert('${v}');modals.close('parts')}">${v} <span class="del" onclick="event.stopPropagation();parts.del(${i})">√ó</span></span>`});
        } else {
           Object.keys(d).forEach(key=>{l.innerHTML+=`<div class="list-item"><span>${key}</span><div><button class="btn" onclick="subMgr.add('${t}','${key}')">ADD</button> <button class="btn danger" onclick="subMgr.del('${t}','${key}')">√ó</button></div></div>`});
        }
      },
      add:(t,key)=>{const db=subMgr.db(t==='char'?'promptChars':'promptSnippets'); const v=t==='char'?(db[key].text||db[key]):db[key]; board.add(t==='char'?'char':'code',v); modals.close(t);},
      del:(t,key)=>{if(confirm('Del?')){const k=t==='char'?'promptChars':'promptSnippets',d=subMgr.db(k);delete d[key];subMgr.save(k,d);subMgr.render(t);}}
    };
    const parts={add:()=>{const el=document.getElementById('partInput'),v=el.value;if(v){const d=JSON.parse(localStorage.getItem('ps_parts')||'[]');d.push(v);localStorage.setItem('ps_parts',JSON.stringify(d));el.value='';subMgr.render('parts');}},del:(i)=>{const d=JSON.parse(localStorage.getItem('ps_parts'));d.splice(i,1);localStorage.setItem('ps_parts',JSON.stringify(d));subMgr.render('parts');}};
    const snippets={add:()=>{const n=document.getElementById('snipName').value,c=document.getElementById('snipContent').value;if(n&&c){const d=subMgr.db('promptSnippets');d[n]=c;subMgr.save('promptSnippets',d);subMgr.render('snippet');}}};
    const projects={save:()=>{const n=document.getElementById('projName').value;if(!n)return;const d=[];document.querySelectorAll('#streamList .card').forEach(c=>d.push({type:c.dataset.type,text:c.querySelector('textarea').value,ctrls:JSON.parse(c.dataset.ctrls)}));const db=JSON.parse(localStorage.getItem('ps_projects')||'{}');db[n]=d;localStorage.setItem('ps_projects',JSON.stringify(db));projects.render();}, load:(n)=>{if(confirm('Load?')){const db=JSON.parse(localStorage.getItem('ps_projects'));document.getElementById('streamList').innerHTML='';db[n].forEach(i=>board.add(i.type,i.text,i.ctrls));modals.close('projects');}}, del:(n)=>{if(confirm('Del?')){const db=JSON.parse(localStorage.getItem('ps_projects'));delete db[n];localStorage.setItem('ps_projects',JSON.stringify(db));projects.render();}}, render:()=>{const l=document.getElementById('projectList'),db=JSON.parse(localStorage.getItem('ps_projects')||'{}');l.innerHTML='';Object.keys(db).forEach(n=>l.innerHTML+=`<div class="list-item"><span>${n}</span><div><button class="btn" onclick="projects.load('${n}')">LOAD</button> <button class="btn danger" onclick="projects.del('${n}')">√ó</button></div></div>`);}};
    
    const storage={save:()=>{const d=[];document.querySelectorAll('#streamList .card').forEach(c=>d.push({type:c.dataset.type,text:c.querySelector('textarea').value,ctrls:JSON.parse(c.dataset.ctrls)}));localStorage.setItem('ps_stream',JSON.stringify(d));}, load:()=>{const d=JSON.parse(localStorage.getItem('ps_stream')||'[]');d.forEach(i=>board.add(i.type,i.text,i.ctrls));}};
    window.onload=board.init;
  </script>
</body>
</html>
